(()=>{frappe.provide("frappe.utils");frappe.utils.pretty_date=window.formatDate=function(n){let e=new Date(n),t=e.getDate(),r=e.toLocaleString("default",{month:"short"}),a=e.getFullYear().toString(),i=e.getHours(),s=e.getMinutes(),o=i>=12?"PM":"AM";return i=i%12||12,s=s.toString().padStart(2,"0"),`${t}-${r}-${a} || ${i}:${s} ${o}`};window.prettyDate=function(n,e){let t=formatDate(n);if(!n)return"";typeof n=="string"&&(n=frappe.datetime.convert_to_user_tz(n),n=new Date((n||"").replace(/-/g,"/").replace(/[TZ]/g," ").replace(/\.[0-9]*/,"")));let r=(new Date(frappe.datetime.now_datetime()).getTime()-n.getTime())/1e3,a=Math.floor(r/86400);if(isNaN(a)||a<0)return"";if(e)if(a==0){if(r<60)return __("now ["+t.replace(/\.\d+/,"")+"] ");if(r<3600)return __("{0} m ["+t.replace(/\.\d+/,"")+"] ",[Math.floor(r/60)]);if(r<86400)return __("{0} h ["+t.replace(/\.\d+/,"")+"] ",[Math.floor(r/3600)])}else return a<7?__("{0} d ["+t.replace(/\.\d+/,"")+"] ",[a]):a<31?__("{0} w ["+t.replace(/\.\d+/,"")+"] ",[Math.floor(a/7)]):a<365?__("{0} M ["+t.replace(/\.\d+/,"")+"] ",[Math.floor(a/30)]):__("{0} y ["+t.replace(/\.\d+/,"")+"] ",[Math.floor(a/365)]);else if(a==0){if(r<60)return __("just now ["+t.replace(/\.\d+/,"")+"] ");if(r<120)return __("1 minute ago ["+t.replace(/\.\d+/,"")+"] ");if(r<3600)return __("{0} minutes ago ["+t.replace(/\.\d+/,"")+"] ",[Math.floor(r/60)]);if(r<7200)return __("1 hour ago ["+t.replace(/\.\d+/,"")+"] ");if(r<86400)return __("{0} hours ago ["+t.replace(/\.\d+/,"")+"] ",[Math.floor(r/3600)])}else return a==1?__("yesterday ["+t.replace(/\.\d+/,"")+"] "):a<7?__("{0} days ago ["+t.replace(/\.\d+/,"")+"] ",[a]):a<14?__("1 week ago"):a<31?__("{0} weeks ago ["+t.replace(/\.\d+/,"")+"] ",[Math.floor(a/7)]):a<62?__("1 month ago"):a<365?__("{0} months ago ["+t.replace(/\.\d+/,"")+"] ",[Math.floor(a/30)]):a<730?__("1 year ago"):__("{0} years ago ["+t.replace(/\.\d+/,"")+"] ",[Math.floor(a/365)])};frappe.provide("frappe.datetime");window.comment_when=function(n,e){var t=frappe.datetime.str_to_user?frappe.datetime.str_to_user(n):n;return'<span class="frappe-timestamp '+(e?" mini":"")+'" data-timestamp="'+n+'" title="'+t+'">'+prettyDate(n,e)+"</span>"};frappe.datetime.comment_when=comment_when;frappe.datetime.prettyDate=prettyDate;frappe.datetime.refresh_when=function(){jQuery&&$(".frappe-timestamp").each(function(){$(this).html(prettyDate($(this).attr("data-timestamp"),$(this).hasClass("mini")))})};setInterval(function(){frappe.datetime.refresh_when()},6e4);frappe.provide("frappe.views");frappe.provide("frappe.interaction_settings");frappe.views.InteractionComposer=class{constructor(e){$.extend(this,e),this.make()}make(){let e=this;e.dialog=new frappe.ui.Dialog({title:e.title||e.subject||__("New Activity"),no_submit_on_enter:!0,fields:e.get_fields(),primary_action_label:__("Create"),primary_action:function(){e.create_action()}}),$(document).on("upload_complete",function(t,r){if(e.dialog.display){let a=$(e.dialog.fields_dict.select_attachments.wrapper),i=a.find("[data-file-name]:checked").map(function(){return $(this).attr("data-file-name")});e.render_attach(),i.push(r.name),$.each(i,function(s,o){a.find('[data-file-name="'+o+'"]').prop("checked",!0)})}}),e.prepare(),e.dialog.show()}get_fields(){let e=this,t=Object.keys(l());return[{label:__("Reference"),fieldtype:"Select",fieldname:"interaction_type",options:t,reqd:1,onchange:()=>{let a=e.get_values();e.get_fields().forEach(i=>{i.fieldname!="interaction_type"&&(e.dialog.set_df_property(i.fieldname,"reqd",0),e.dialog.set_df_property(i.fieldname,"hidden",0))}),e.set_reqd_hidden_fields(a),e.get_event_categories()}},{label:__("Category"),fieldtype:"Select",fieldname:"category",options:"",hidden:1,default:"Meeting",onchange:()=>{var a=document.querySelector('select[data-fieldname="category"]'),i=a.value;i=="Meeting"?e.dialog.set_df_property("custom_meeting_party_type","hidden",0):e.dialog.set_df_property("custom_meeting_party_type","hidden",1)}},{label:__("Meeting Party Type"),fieldtype:"Link",fieldname:"custom_meeting_party_type",options:"Party Type",hidden:1},{label:__("Public"),fieldtype:"Check",fieldname:"public",default:"1"},{fieldtype:"Column Break"},{label:__("Date"),fieldtype:"Datetime",fieldname:"due_date"},{label:__("Assigned To"),fieldtype:"Link",fieldname:"assigned_to",options:"User"},{fieldtype:"Section Break"},{label:__("Summary"),fieldtype:"Data",fieldname:"summary"},{fieldtype:"Section Break"},{fieldtype:"Text Editor",fieldname:"description"},{fieldtype:"Section Break"},{label:__("Select Attachments"),fieldtype:"HTML",fieldname:"select_attachments"}]}get_event_categories(){let e=this;frappe.model.with_doctype("Event",()=>{let t=frappe.meta.get_docfield("Event","event_category").options.split(`
`);e.dialog.get_input("category").empty().add_options(t)})}prepare(){this.setup_attach()}set_reqd_hidden_fields(e){let t=this;if(e&&"interaction_type"in e){let r=l();r[e.interaction_type].reqd_fields.forEach(a=>{t.dialog.set_df_property(a,"reqd",1)}),r[e.interaction_type].hidden_fields.forEach(a=>{t.dialog.set_df_property(a,"hidden",1)})}}setup_attach(){var e=this.dialog.fields_dict,t=$(e.select_attachments.wrapper);this.attachments||(this.attachments=[]);let r={folder:"Home/Attachments",on_success:a=>this.attachments.push(a)};this.frm&&(r={doctype:this.frm.doctype,docname:this.frm.docname,folder:"Home/Attachments",on_success:a=>{this.frm.attachments.attachment_uploaded(a),this.render_attach()}}),$("<h6 class='text-muted add-attachment' style='margin-top: 12px; cursor:pointer;'>"+__("Select Attachments")+"</h6><div class='attach-list'></div>			<p class='add-more-attachments'>			<a class='text-muted small'><i class='octicon octicon-plus' style='font-size: 12px'></i> "+__("Add Attachment")+"</a></p>").appendTo(t.empty()),t.find(".add-more-attachments a").on("click",()=>new frappe.ui.FileUploader(r)),this.render_attach()}render_attach(){let e=this.dialog.fields_dict,t=$(e.select_attachments.wrapper).find(".attach-list").empty(),r=[];this.attachments&&this.attachments.length&&(r=r.concat(this.attachments)),cur_frm&&(r=r.concat(cur_frm.get_files())),r.length&&$.each(r,function(a,i){!i.file_name||(i.file_url=frappe.urllib.get_full_url(i.file_url),$(repl('<p class="checkbox"><label><span><input type="checkbox" data-file-name="%(name)s"></input></span><span class="small">%(file_name)s</span> <a href="%(file_url)s" target="_blank" class="text-muted small"><i class="fa fa-share" style="vertical-align: middle; margin-left: 3px;"></i></label></p>',i)).appendTo(t))})}create_action(){let e=this,t=e.dialog.get_primary_btn(),r=this.get_values();if(!r)return;let a=$.map($(e.dialog.wrapper).find("[data-file-name]:checked"),function(i){return $(i).attr("data-file-name")});e.create_interaction(t,r,a)}get_values(){let e=this,t=this.dialog.get_values(!0);return t&&(t.reference_doctype=e.frm.doc.doctype,t.reference_document=e.frm.doc.name),t}create_interaction(e,t,r){let a=this;a.dialog.hide();let i=l(),s={};return Object.keys(t).forEach(o=>{s[i[t.interaction_type].field_map[o]]=t[o]}),"event_type"in s&&(s.event_type=t.public==1?"Public":"Private"),s.doctype=="Event"&&(s.event_participants=[{reference_doctype:t.reference_doctype,reference_docname:t.reference_document}]),"owner"in s||(s.owner=frappe.session.user),!("assigned_by"in s)&&s.doctype=="ToDo"&&(s.assigned_by=frappe.session.user),frappe.call({method:"frappe.client.insert",args:{doc:s},btn:e,callback:function(o){o.exc?frappe.msgprint(__("There were errors while creating the document. Please try again.")):(frappe.show_alert({message:__("{0} created successfully",[t.interaction_type]),indicator:"green"}),"assigned_to"in t&&a.assign_document(o.message,t.assigned_to),r&&a.add_attachments(o.message,r),cur_frm&&cur_frm.reload_doc())}})}assign_document(e,t){e.doctype!="ToDo"&&frappe.call({method:"frappe.desk.form.assign_to.add",args:{doctype:e.doctype,name:e.name,assign_to:JSON.stringify([t])},callback:function(r){if(r.exc){frappe.show_alert({message:__("The document could not be correctly assigned"),indicator:"orange"});return}else{frappe.show_alert({message:__("The document has been assigned to {0}",[t]),indicator:"green"});return}}})}add_attachments(e,t){frappe.call({method:"frappe.utils.file_manager.add_attachments",args:{doctype:e.doctype,name:e.name,attachments:JSON.stringify(t)},callback:function(r){if(r.exc){frappe.show_alert({message:__("The attachments could not be correctly linked to the new document"),indicator:"orange"});return}else return}})}};function l(){return{Event:{field_map:{interaction_type:"doctype",summary:"subject",description:"description",category:"event_category",custom_meeting_party_type:"custom_meeting_party_type",due_date:"starts_on",public:"event_type"},reqd_fields:["summary","due_date"],hidden_fields:[]},ToDo:{field_map:{interaction_type:"doctype",description:"description",due_date:"date",reference_doctype:"reference_type",reference_document:"reference_name",assigned_to:"owner"},reqd_fields:["description"],hidden_fields:["public","category"]}}}})();
//# sourceMappingURL=pretty_date.bundle.XOWIXJKM.js.map
